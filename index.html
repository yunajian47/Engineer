<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Diary | æ±¡æ°´ä¸‹æ°´é“å·¥ç¨‹</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Nunito:wght@400;600;700;800&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        :root {
            /* --- Water Diary é…è‰²ç³»çµ± --- */
            --bg-cream: #FFF9F5;          
            --card-white: #FFFFFF;        
            
            --color-rose: #E5989B;       /* é‡é»è‰² */
            --color-rose-light: #FFF0F3;
            --color-sage: #84A98C;       /* ç¶ è‰² */
            --color-sage-light: #F0FDF4;
            --color-sand: #D4A373;       /* åœŸè‰² */
            --color-sand-light: #FEFBEA;
            --color-note: #FEFBEA;       /* ç­†è¨˜åº•è‰² */
            --color-risk: #FFF0F3;       /* é¢¨éšªåº•è‰² */
            
            --text-main: #4A4A4A;        /* åŠ æ·±æ–‡å­—é¡è‰²ä»¥æå‡é–±è®€æ€§ */
            --text-title: #2D2D2D;       
            
            --shadow-soft: 0 10px 40px -10px rgba(229, 152, 155, 0.25);
            --shadow-hover: 0 15px 50px -10px rgba(229, 152, 155, 0.4);
            --radius-bubble: 30px;
            --radius-md: 16px;
            
            --z-blob: -1;
            --z-sidebar: 100;
            --z-mobile-btn: 101;
            --z-modal: 1000;
            --z-login: 9999;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Noto Sans TC', 'Nunito', sans-serif;
            background-color: var(--bg-cream);
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            overflow-x: hidden;
            line-height: 1.8;
        }

        /* --- ç™»å…¥é®ç½©å±¤ --- */
        #login-overlay {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(255, 249, 245, 0.98);
            backdrop-filter: blur(15px);
            z-index: var(--z-login);
            display: flex; justify-content: center; align-items: center;
            transition: opacity 0.6s ease, visibility 0.6s ease;
        }
        .login-card {
            background: white; padding: 3rem; border-radius: 30px;
            box-shadow: 0 25px 50px -12px rgba(229, 152, 155, 0.25);
            text-align: center; max-width: 400px; width: 90%;
            border: 2px solid white;
        }
        .login-title { font-family: 'DM Serif Display', serif; font-size: 2.5rem; color: var(--text-title); margin-bottom: 0.5rem; }
        
        /* é€šç”¨ Input èˆ‡ Button */
        .login-input {
            width: 100%; padding: 12px 15px; margin: 10px 0; border: 2px solid #EEE;
            border-radius: 15px; font-size: 1rem; text-align: center; outline: none; transition: 0.3s;
            background: #FAFAFA; color: var(--text-title);
        }
        .login-input:focus { border-color: var(--color-rose); background: white; }
        
        .login-btn {
            background: var(--color-rose); color: white; border: none;
            padding: 12px 30px; border-radius: 50px; font-size: 1rem; font-weight: 800;
            cursor: pointer; transition: 0.3s; box-shadow: 0 10px 20px -5px rgba(229, 152, 155, 0.4);
            display: inline-block;
        }
        .login-btn:hover { transform: translateY(-3px); box-shadow: 0 15px 30px -5px rgba(229, 152, 155, 0.6); }
        .shake { animation: shake 0.5s; }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-10px); } 50% { transform: translateX(10px); } 75% { transform: translateX(-10px); } 100% { transform: translateX(0); } }

        /* --- èƒŒæ™¯è£é£¾ --- */
        .blob { position: fixed; border-radius: 50%; filter: blur(80px); z-index: var(--z-blob); opacity: 0.6; animation: floatBlob 10s infinite alternate; }
        .blob-1 { top: -10%; right: -10%; width: 500px; height: 500px; background: #FFCDB2; }
        .blob-2 { bottom: -10%; left: -10%; width: 400px; height: 400px; background: #E5E5F7; }
        @keyframes floatBlob { from { transform: translate(0,0); } to { transform: translate(20px, 20px); } }

        /* --- Sidebar & Navigation --- */
        .mobile-menu-btn {
            display: none; position: fixed; top: 1.5rem; right: 1.5rem;
            background: white; width: 50px; height: 50px; border-radius: 50%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); z-index: var(--z-mobile-btn);
            justify-content: center; align-items: center; font-size: 1.5rem;
            color: var(--color-rose); cursor: pointer; transition: 0.3s;
        }
        .sidebar {
            width: 280px; margin: 2rem; background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px); border-radius: var(--radius-bubble);
            padding: 3rem 1.5rem; display: flex; flex-direction: column;
            box-shadow: var(--shadow-soft); height: calc(100vh - 4rem);
            position: sticky; top: 2rem; flex-shrink: 0;
            overflow-y: auto; z-index: var(--z-sidebar);
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .sidebar::-webkit-scrollbar { width: 0px; background: transparent; }
        .brand { 
            font-family: 'DM Serif Display', serif; font-size: 1.8rem; 
            color: var(--color-rose); margin-bottom: 2.5rem; text-align: center; 
            font-style: italic; cursor: pointer; user-select: none;
        }
        .nav-menu { display: flex; flex-direction: column; gap: 0.8rem; }
        .nav-item {
            display: flex; align-items: center; padding: 1rem 1.5rem;
            text-decoration: none; color: var(--text-main); font-weight: 700;
            border-radius: 20px; transition: all 0.3s ease; cursor: pointer;
            border: 1px solid transparent;
        }
        .nav-item:hover { background-color: var(--color-rose-light); color: var(--color-rose); }
        .nav-item.active { 
            background-color: var(--color-rose-light); color: var(--color-rose); 
            box-shadow: 0 4px 15px rgba(229, 152, 155, 0.15); border-color: #FFE5D9;
        }
        .nav-icon { margin-right: 12px; font-size: 1.2rem; width: 24px; text-align: center;}
        .nav-dropdown-trigger { justify-content: space-between; }
        .arrow-icon { font-size: 0.8rem; transition: transform 0.3s; color: #BBB; }
        .nav-item.open .arrow-icon { transform: rotate(180deg); color: var(--color-rose); }
        .sub-menu {
            display: none; flex-direction: column; gap: 5px;
            padding-left: 20px; margin-top: 5px; margin-bottom: 5px;
            animation: slideDown 0.3s ease-out;
        }
        .sub-item {
            padding: 0.8rem 1.5rem; font-size: 0.9rem; color: #888; font-weight: 600;
            border-radius: 15px; cursor: pointer; transition: 0.2s;
            display: flex; align-items: center;
        }
        .sub-item::before { content: 'â€¢'; margin-right: 10px; font-size: 1.2rem; opacity: 0.5; }
        .sub-item:hover { color: var(--color-rose); background: rgba(255,255,255,0.5); }
        .sub-item.active { color: var(--color-rose); font-weight: 800; background: var(--color-rose-light); }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Main Content --- */
        .main-content { flex: 1; padding: 2rem 4rem; max-width: 1200px; width: 100%; transition: 0.3s; }
        .view-section { display: none; animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        header { margin-bottom: 3rem; padding-top: 1rem; }
        h1 { font-family: 'DM Serif Display', serif; font-size: 3.5rem; color: var(--text-title); font-weight: 400; margin-bottom: 0.5rem; line-height: 1.1; letter-spacing: -1px; }
        h1 span { color: var(--color-rose); font-style: italic; }
        .subtitle { font-size: 1.1rem; color: #999; font-weight: 500; }

        /* Grid Cards */
        .grid-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 2rem; margin-top: 2rem; }
        .pretty-card {
            background: var(--card-white); border-radius: var(--radius-bubble); padding: 2.5rem 2rem;
            text-align: center; transition: 0.3s; box-shadow: 0 5px 25px rgba(0,0,0,0.03);
            border: 2px solid transparent; cursor: pointer; position: relative; overflow: hidden;
        }
        .pretty-card:hover { transform: translateY(-8px); box-shadow: var(--shadow-hover); border-color: #FFCDB2; }
        .card-emoji { font-size: 3.5rem; background: var(--color-rose-light); width: 90px; height: 90px; line-height: 90px; border-radius: 50%; margin: 0 auto 1.5rem auto; transition: 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .pretty-card:hover .card-emoji { transform: rotate(10deg) scale(1.1); background: #FFD7E0; }
        .card-name { font-size: 1.25rem; font-weight: 800; color: var(--text-main); margin-bottom: 0.8rem; }
        .card-desc { font-size: 0.95rem; color: #999; line-height: 1.6; }

        /* --- Article Styles --- */
        .chapter-header { background: var(--color-rose-light); padding: 3rem 4rem; border-radius: var(--radius-bubble) var(--radius-bubble) 0 0; border-bottom: 1px dashed #FFE5D9; }
        .chapter-body { background: white; padding: 4rem; border-radius: 0 0 var(--radius-bubble) var(--radius-bubble); box-shadow: 0 5px 30px rgba(0,0,0,0.02); }
        .note-box { background: var(--color-note); padding: 2rem; border-radius: var(--radius-md); margin: 2rem 0; border-left: 5px solid var(--color-sand); box-shadow: 0 5px 15px rgba(0,0,0,0.03); }
        .risk-box { background: var(--color-risk); padding: 2rem; border-radius: var(--radius-md); margin: 2rem 0; border: 1px solid #FFDEE2; position: relative; }
        
        .table-container { width: 100%; overflow-x: auto; border-radius: 12px; margin: 1.5rem 0; border: 1px solid #EEE; }
        .styled-table { width: 100%; border-collapse: collapse; font-size: 0.95rem; background: white; min-width: 600px; }
        .styled-table th, .styled-table td { padding: 18px 25px; border-bottom: 1px solid #EEE; text-align: left; vertical-align: middle; }
        .styled-table th { background: #FAFAFA; color: var(--color-sage); font-weight: 800; border-bottom: 2px solid var(--color-sage); white-space: nowrap; }
        .styled-table tr:last-child td { border-bottom: none; }
        .geo-badge { display: inline-block; padding: 5px 12px; border-radius: 8px; color: white; font-weight: 800; font-size: 0.85rem; min-width: 80px; text-align: center; }

        h3 { font-size: 1.5rem; color: var(--color-sand); margin-top: 3.5rem; margin-bottom: 1.5rem; border-left: 6px solid #FFE5D9; padding-left: 1rem; font-weight: 800; line-height: 1.3; }
        h4 { font-size: 1.2rem; color: var(--color-rose); margin-top: 1.5rem; margin-bottom: 1rem; font-weight: 700; display: flex; align-items: center; }
        
        .math-box { background: #F9FAFB; padding: 2rem; border-radius: 16px; margin: 1.5rem 0; border: 1px dashed #DDD; text-align: center; font-size: 1.15rem; overflow-x: auto; }

        /* Links & Modal */
        .def-link { color: var(--color-rose); font-weight: 700; cursor: pointer; border-bottom: 1px dashed var(--color-rose); transition: all 0.2s; position: relative; padding-bottom: 1px; }
        .def-link:hover { background-color: var(--color-rose-light); border-bottom-style: solid; color: #D67C80; }
        .def-link::after { content: '?'; font-size: 0.7rem; vertical-align: super; margin-left: 2px; opacity: 0.6; font-weight: 800; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.4); backdrop-filter: blur(8px); z-index: var(--z-modal); display: none; justify-content: center; align-items: center; opacity: 0; transition: opacity 0.3s; }
        .modal-overlay.active { display: flex; opacity: 1; }
        .modal-card { background: white; width: 90%; max-width: 550px; border-radius: var(--radius-bubble); padding: 3rem; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.15); position: relative; border: 1px solid white; transform: translateY(20px); transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        .modal-overlay.active .modal-card { transform: translateY(0); }
        .modal-close { position: absolute; top: 25px; right: 30px; width: 32px; height: 32px; font-size: 1.8rem; color: #DDD; cursor: pointer; transition: 0.2s; display: flex; justify-content: center; align-items: center; border-radius: 50%; }
        .modal-close:hover { color: var(--color-rose); background: #FFF0F3; }
        .modal-title { font-family: 'DM Serif Display', serif; font-size: 2.2rem; color: var(--text-title); margin-bottom: 1rem; border-bottom: 4px solid var(--color-note); display: inline-block; padding-bottom: 5px; line-height: 1.1; }
        .modal-content { font-size: 1.05rem; color: var(--text-main); line-height: 1.8; margin-top: 1rem; }
        .modal-tag { display: inline-block; background: var(--color-note); color: var(--color-sand); padding: 5px 15px; border-radius: 20px; font-size: 0.8rem; font-weight: 800; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 1px; }

        .status-badge { display: inline-block; padding: 4px 12px; border-radius: 15px; color: white; font-weight: 700; font-size: 0.85rem; }
        .status-green { background: #6BCB77; }
        .status-yellow { background: #FFD93D; color: #555; }
        .status-red { background: #FF6B6B; }

        /* Tabs */
        .tab-nav { display: flex; gap: 1rem; border-bottom: 2px solid #F0F0F0; margin-bottom: 2.5rem; overflow-x: auto; padding-bottom: 10px; }
        .tab-btn { padding: 10px 20px; background: none; border: none; font-size: 1.1rem; font-weight: 700; color: #BBB; cursor: pointer; border-bottom: 3px solid transparent; transition: 0.3s; white-space: nowrap; flex-shrink: 0; }
        .tab-btn:hover { color: var(--color-rose); }
        .tab-btn.active { color: var(--color-rose); border-bottom-color: var(--color-rose); }
        .inner-tab-content { display: none; animation: fadeIn 0.4s ease; }
        .inner-tab-content.active { display: block; }

        /* --- â˜…â˜…â˜… Markdown Layout & Styles (FIXED) â˜…â˜…â˜… --- */
        #markdown-container { 
            background: white; 
            padding: 0; 
            border-radius: var(--radius-bubble); 
            box-shadow: 0 5px 30px rgba(0,0,0,0.02); 
            margin-top: 1rem; 
            /* ç§»é™¤äº† overflow: hiddenï¼Œè®“ sticky å¯ä»¥æ­£å¸¸é‹ä½œ */
        }
        
        .md-layout { 
            display: flex; 
            align-items: flex-start; 
            gap: 40px; 
            /* å°‡å³å´ padding è¨­ç‚º 0ï¼Œè®“ç›®éŒ„å¯ä»¥é åˆ°æœ€å³é‚Š */
            padding: 3rem 0 3rem 4rem; 
            justify-content: space-between; 
        }
        
        .md-content { 
            flex: 1; 
            min-width: 0; 
            font-size: 1.15rem; 
            line-height: 1.9; 
            color: #333; 
            /* å¢åŠ å³å´ paddingï¼Œé¿å…æ–‡å­—èˆ‡ç›®éŒ„å¤ªè¿‘ */
            padding-right: 20px; 
        }
        
        .md-content h1 { color: var(--text-title); font-size: 2.4rem; margin-top: 1rem; margin-bottom: 1.5rem; border-bottom: 3px solid var(--color-rose-light); padding-bottom: 15px; font-family: 'DM Serif Display'; }
        .md-content h2 { color: var(--color-rose); font-size: 1.8rem; margin-top: 3rem; margin-bottom: 1.2rem; font-weight: 700; position: relative; padding-left: 15px; }
        .md-content h2::before { content: ''; position: absolute; left: 0; top: 5px; bottom: 5px; width: 5px; background: var(--color-rose); border-radius: 5px; }
        .md-content h3 { color: var(--color-sand); font-size: 1.4rem; margin-top: 2.5rem; margin-bottom: 1rem; border-left: none; padding-left: 0; display: flex; align-items: center; }
        .md-content h3::before { content: 'â– '; font-size: 0.8em; margin-right: 10px; color: var(--color-sand-light); background: var(--color-sand); -webkit-background-clip: text; color: transparent; background-clip: text; }
        .md-content p { margin-bottom: 1.2rem; text-align: justify; }
        .md-content img { display: block; margin: 2rem auto; max-width: 100%; max-height: 600px; object-fit: contain; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); border: 1px solid #F5F5F5; }
        .md-content ul, .md-content ol { padding-left: 1.5rem; margin-bottom: 1.5rem; }
        .md-content blockquote { background: var(--color-note); border-left: 6px solid var(--color-sand); margin: 2rem 0; padding: 1.5rem 2rem; border-radius: 0 12px 12px 0; font-style: italic; color: #555; }
        .md-content table { width: 100%; border-collapse: collapse; margin: 2rem 0; font-size: 1rem; }
        .md-content th { background: #FAFAFA; border-bottom: 2px solid var(--color-sage); padding: 12px 15px; text-align: left; color: var(--color-sage); font-weight: 800; }
        .md-content td { padding: 12px 15px; border-bottom: 1px solid #EEE; }
        
        /* Sticky Sidebar TOC */
        .md-toc { 
            width: 260px; 
            position: sticky; 
            top: 80px; /* è·é›¢é ‚éƒ¨çš„é«˜åº¦ */
            max-height: calc(100vh - 100px); 
            overflow-y: auto; 
            border-left: 2px solid #F0F0F0; 
            padding-left: 25px; 
            padding-right: 2rem; /* å³å´ä¿ç•™ä¸€é»å‘¼å¸ç©ºé–“ï¼Œä¸è²¼æ­»ç€è¦½å™¨é‚Šç·£ */
            flex-shrink: 0;
            height: fit-content; 
        }
        .md-toc h4 { color: #BBB; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px; margin-top: 0; }
        .toc-list { list-style: none; padding: 0; margin: 0; }
        .toc-item { margin-bottom: 8px; font-size: 0.95rem; line-height: 1.4; }
        .toc-link { color: #888; text-decoration: none; display: block; transition: 0.2s; padding: 2px 0; }
        .toc-link:hover { color: var(--color-rose); transform: translateX(5px); }
        .toc-link.active { color: var(--color-rose); font-weight: 700; border-left: 2px solid var(--color-rose); padding-left: 10px; margin-left: -22px; }
        .toc-h2 { margin-left: 0; font-weight: 600; }
        .toc-h3 { margin-left: 15px; font-size: 0.9rem; }

        /* --- â˜…â˜…â˜… è¨ˆç®—æ©Ÿæ¨£å¼ (Calculator Styles) â˜…â˜…â˜… --- */
        .calc-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem; }
        .calc-section-title { color: var(--color-sage); font-size: 1.2rem; font-weight: 800; margin: 2rem 0 1rem 0; border-bottom: 1px solid #EEE; padding-bottom: 10px; }
        .calc-label { font-weight: 700; color: var(--text-main); margin-bottom: 8px; display: block; font-size: 0.95rem; }
        
        .wd-radio-group { display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap; }
        .wd-radio-group label { background: white; border: 2px solid #EEE; padding: 10px 20px; border-radius: 50px; cursor: pointer; transition: 0.2s; font-weight: 700; color: #999; font-size: 0.9rem; }
        .wd-radio-group input { display: none; }
        .wd-radio-group label:has(input:checked) { border-color: var(--color-rose); background: var(--color-rose-light); color: var(--color-rose); }

        .result-card { background: white; border-radius: 16px; padding: 2rem; border: 1px dashed #DDD; margin-top: 1.5rem; box-shadow: 0 5px 20px rgba(0,0,0,0.03); }
        .result-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px dashed #F0F0F0; font-size: 1rem; }
        .result-row.highlight { border: none; margin-top: 15px; padding-top: 15px; border-top: 2px solid var(--color-sage); }
        .result-val { font-family: 'Nunito', sans-serif; font-weight: 800; color: var(--text-title); }
        .result-val.xl { color: var(--color-rose); font-size: 1.5rem; }

        .quick-table { width: 100%; border-collapse: collapse; margin-top: 1rem; font-size: 0.95rem; }
        .quick-table th { background: var(--color-sand); color: white; padding: 12px; }
        .quick-table td { padding: 12px; border-bottom: 1px solid #EEE; text-align: center; }
        .quick-table tr:hover td { background: var(--color-sand-light); }

        /* RWD */
        @media (max-width: 900px) {
            .mobile-menu-btn { display: flex; }
            .sidebar { position: fixed; top: 0; left: 0; margin: 0; height: 100vh; transform: translateX(-100%); width: 280px; border-radius: 0 30px 30px 0; }
            .sidebar.mobile-active { transform: translateX(0); box-shadow: 0 0 100px rgba(0,0,0,0.5); }
            .sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); z-index: 99; display: none; backdrop-filter: blur(3px); opacity: 0; transition: opacity 0.3s; }
            .sidebar-overlay.active { display: block; opacity: 1; }
            .main-content { padding: 1.5rem; width: 100%; }
            .chapter-header { padding: 2rem; }
            .chapter-body { padding: 2rem 1.5rem; }
            .md-layout { flex-direction: column; padding: 2rem 1.5rem; }
            .md-toc { display: none; }
            .tab-nav { flex-direction: row; gap: 5px; border-bottom: none; overflow-x: auto; -webkit-overflow-scrolling: touch; }
            .tab-btn { border: 1px solid #EEE; border-radius: 20px; margin-bottom: 5px; border-bottom: 1px solid #EEE; }
            .tab-btn.active { background: var(--color-rose-light); border-color: var(--color-rose); border-bottom: 1px solid var(--color-rose); }
        }
    </style>
</head>
<body>

    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>

    <div id="login-overlay">
        <div class="login-card" id="login-box">
            <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ”’</div>
            <div class="login-title">Water Diary</div>
            <p style="color: #999; margin-bottom: 1rem;">è«‹è¼¸å…¥å¯†ç¢¼è§£é–</p>
            <input type="password" id="password-input" class="login-input" placeholder="Password">
            <button class="login-btn" onclick="checkPassword()">Unlock</button>
        </div>
    </div>

    <div class="modal-overlay" id="glossary-modal" onclick="closeModal(event)">
        <div class="modal-card" onclick="event.stopPropagation()">
            <div class="modal-close" onclick="closeModal(event)">Ã—</div>
            <span class="modal-tag">Term Definition</span><br>
            <div class="modal-title" id="modal-term-title">Title</div>
            <div class="modal-content" id="modal-term-desc">Description goes here.</div>
        </div>
    </div>

    <div class="mobile-menu-btn" onclick="toggleSidebar()"><i class="fa-solid fa-bars"></i></div>
    <div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>

    <nav class="sidebar" id="main-sidebar">
        <div class="brand" onclick="navigate('dashboard')">Water Diary.</div>
        <div class="nav-menu">
            <div class="nav-item active" data-target="dashboard" onclick="navigate('dashboard')">
                <div style="display:flex; align-items:center;"><span class="nav-icon">âœ¨</span> ç¸½è¦½ Daily</div>
            </div>
            <div class="nav-item" data-target="calculator" onclick="navigate('calculator')">
                <div style="display:flex; align-items:center;"><span class="nav-icon">ğŸ§®</span> è¨ˆç®—æ©Ÿ Tool</div>
            </div>
            <div class="nav-item" data-target="tools" onclick="navigate('tools')">
                <div style="display:flex; align-items:center;"><span class="nav-icon">ğŸŒ¿</span> è³‡æ–™åº« Data</div>
            </div>
            <div class="nav-item nav-dropdown-trigger" id="btn-learn" onclick="toggleDropdown('menu-learn')">
                <div style="display:flex; align-items:center;"><span class="nav-icon">ğŸ“–</span> å­¸ç¿’ Note</div>
                <i class="fa-solid fa-chevron-down arrow-icon"></i>
            </div>
            <div class="sub-menu" id="menu-learn">
                <div class="sub-item" data-target="phase1" onclick="navigate('phase1')">Phase 1: ä¸Šä½è¨ˆç•«</div>
                <div class="sub-item" data-target="phase2" onclick="navigate('phase2')">Phase 2: ç’°å¢ƒèª¿æŸ¥</div>
                <div class="sub-item" data-target="phase3" onclick="navigate('phase3')">Phase 3: è¨­è¨ˆæº–å‰‡</div>
                <div class="sub-item" data-target="phase4" onclick="navigate('phase4')">Phase 4: æ–½å·¥æ–¹æ¡ˆ</div>
                <div class="sub-item" data-target="phase5" onclick="navigate('phase5')">Phase 5: ç’°ä¿ç¯€èƒ½</div>
            </div>
            <div class="nav-item">
                <div style="display:flex; align-items:center;"><span class="nav-icon">â˜ï¸</span> é›²ç«¯ Cloud</div>
            </div>
        </div>
    </nav>

    <main class="main-content">
        
        <section id="view-dashboard" class="view-section active">
            <header>
                <h1>Hello, <span>Engineer</span></h1>
                <p class="subtitle">ä»Šå¤©åˆè¦ä¸Šç­äº† ğŸ˜© </p>
            </header>
            <div class="grid-cards">
                <div class="pretty-card" onclick="navigate('tools')"><div class="card-emoji">ğŸ“‚</div><div class="card-name">è³‡æ–™åº«</div><div class="card-desc">é»æ­¤æŸ¥è©¢ QGISã€åœ°æ”¿ã€æ°´åˆ©ç›¸é—œæ“ä½œæ‰‹å†Šã€‚</div></div>
                <div class="pretty-card" onclick="navigate('calculator')"><div class="card-emoji">ğŸ§®</div><div class="card-name">æ±¡æ°´ç®¡æµè¨ˆç®—æ©Ÿ</div><div class="card-desc">è¨­è¨ˆæµé‡æ¨ä¼°ã€å–®ç®¡æª¢æ ¸èˆ‡ç®¡å¾‘é€ŸæŸ¥ã€‚</div></div>
                <div class="pretty-card"><div class="card-emoji">ğŸ§ª</div><div class="card-name">å·¥ç¨‹å°å¹«æ‰‹</div><div class="card-desc">å¸¸ç”¨ç®¡å¾‘æ›ç®—ã€‚</div></div>
                <div class="pretty-card"><div class="card-emoji">ğŸš‘</div><div class="card-name">SOS æ•‘æ´</div><div class="card-desc">ç•°å¸¸ç‹€æ³æ’é™¤çš„æ¨™æº–æµç¨‹æ±ºç­–æ¨¹ã€‚</div></div>
            </div>
        </section>

        <section id="view-calculator" class="view-section">
            <header>
                <div style="font-size:0.9rem; color:var(--color-rose); font-weight:700; margin-bottom:10px; letter-spacing:1px;">ENGINEERING TOOL</div>
                <h1>Hydraulic <span style="color:var(--color-rose);">Calculator</span></h1>
            </header>

            <div class="tab-nav">
                <button class="tab-btn active" onclick="switchCalcTab('tab1', this)">1. è¨­è¨ˆæµé‡æ¨ä¼°</button>
                <button class="tab-btn" onclick="switchCalcTab('tab2', this)">2. å–®ç®¡æ°´ç†æª¢æ ¸</button>
                <button class="tab-btn" onclick="switchCalcTab('tab3', this)">3. ç®¡å¾‘èˆ‡å¡åº¦é€ŸæŸ¥</button>
            </div>

            <div id="tab1" class="inner-tab-content active">
                <div class="chapter-body">
                    <h3 style="margin-top:0;">1. ä½å®…èˆ‡å•†æ¥­å€ (åŸºæœ¬è³‡æ–™)</h3>
                    
                    <div class="wd-radio-group">
                        <label><input type="radio" name="popMode" value="density" checked onchange="togglePopMode()"><span>ä¾å¯†åº¦æ¨ä¼°</span></label>
                        <label><input type="radio" name="popMode" value="direct" onchange="togglePopMode()"><span>ç›´æ¥è¼¸å…¥äººå£</span></label>
                    </div>

                    <div id="popInputDensity">
                        <div class="calc-grid">
                            <div><span class="calc-label">ä½å®…å€é¢ç© (ha)</span><input type="number" id="resArea" class="login-input" placeholder="0"></div>
                            <div><span class="calc-label">ä½å®…å€å¯†åº¦ (äºº/ha)</span><input type="number" id="resDensity" class="login-input" placeholder="0"></div>
                            <div><span class="calc-label">å•†æ¥­å€é¢ç© (ha)</span><input type="number" id="comArea" class="login-input" placeholder="0"></div>
                            <div><span class="calc-label">å•†æ¥­å€å¯†åº¦ (äºº/ha)</span><input type="number" id="comDensity" class="login-input" placeholder="0"></div>
                        </div>
                        <div class="note-box" style="padding:15px; display:flex; justify-content:space-between; align-items:center; background:#F0FDF4; border-color:#86EFAC;">
                            <span style="font-weight:700; color:#333;">ç›®å‰æ¨ä¼°äººå£ (è‡ªå‹•è¨ˆç®—)ï¼š</span>
                            <span style="font-size:1.4rem; font-weight:800; color:#15803D;" id="calcPopResult">0</span>
                        </div>
                    </div>

                    <div id="popInputDirect" style="display:none; margin-bottom:20px;">
                        <span class="calc-label">ç›´æ¥è¼¸å…¥è¨ˆç•«äººå£æ•¸ (äºº)</span>
                        <input type="number" id="population" class="login-input" placeholder="ä¾‹å¦‚: 5000">
                    </div>

                    <div class="calc-grid" style="margin-top:20px;">
                        <div><span class="calc-label">æ¯äººæ¯æ—¥æ±¡æ°´é‡ (LPCD)</span><input type="number" id="lpcd" class="login-input" value="225"></div>
                    </div>

                    <h3 style="border-left-color:var(--color-sage); color:var(--color-sage);">2. å…¶ä»–åˆ†å€æ±¡æ°´é‡</h3>
                    <div class="calc-grid">
                        <div><span class="calc-label">å·¥æ¥­å€ (ha)</span><input type="number" id="indArea" class="login-input" placeholder="0"></div>
                        <div><span class="calc-label">å–®ä½é‡ (CMD/ha)</span><input type="number" id="indUnit" class="login-input" value="10"></div>
                        <div><span class="calc-label">æ©Ÿé—œç”¨åœ° (ha)</span><input type="number" id="govArea" class="login-input" placeholder="0"></div>
                        <div><span class="calc-label">å–®ä½é‡ (CMD/ha)</span><input type="number" id="govUnit" class="login-input" value="50"></div>
                        <div><span class="calc-label">å­¸æ ¡ç”¨åœ° (ha)</span><input type="number" id="schArea" class="login-input" placeholder="0"></div>
                        <div><span class="calc-label">å–®ä½é‡ (CMD/ha)</span><input type="number" id="schUnit" class="login-input" value="50"></div>
                        <div><span class="calc-label">å…¬åœ’ç¶ åœ° (ha)</span><input type="number" id="parkArea" class="login-input" placeholder="0"></div>
                        <div><span class="calc-label">å–®ä½é‡ (CMD/ha)</span><input type="number" id="parkUnit" class="login-input" value="8"></div>
                    </div>

                    <h3 style="border-left-color:var(--color-rose); color:var(--color-rose);">3. å…¥æ»²ç‡è¨­å®š</h3>
                    <div class="calc-grid">
                        <div>
                            <span class="calc-label">åœ°ä¸‹æ°´å…¥æ»²ç‡ (%)</span>
                            <input type="number" id="infiltrationRate" class="login-input" value="10">
                        </div>
                    </div>

                    <button class="login-btn" onclick="calculateFlow()" style="width:100%; margin-top:20px;">è¨ˆç®—è¨­è¨ˆæµé‡ Calculate</button>

                    <div class="result-card">
                        <div class="result-row"><span>ç¸½åŸºç¤æ±¡æ°´é‡ (Base Flow)</span><span class="result-val" id="calcBaseFlow">0 CMD</span></div>
                        <div class="result-row"><span>è¨ˆç®—å…¥æ»²é‡ (Infiltration)</span><span class="result-val" id="calcInfFlow">0 CMD</span></div>
                        <div class="result-row"><span>å¹³å‡æ—¥æ±¡æ°´é‡ (Q<sub>avg</sub>)</span><span class="result-val" id="resQavg">0 CMD</span></div>
                        <hr style="border:0; border-top:1px dashed #EEE; margin:15px 0;">
                        <div class="result-row"><span>PF è¨ˆç®—ç”¨ç­‰å€¼äººå£</span><span class="result-val" id="resPopPF" style="color:var(--color-sage);">0 äºº</span></div>
                        <div class="result-row"><span>å°–å³°ä¿‚æ•¸ (PF)</span><span class="result-val" id="resPF">0</span></div>
                        <div class="result-row highlight">
                            <span style="font-size:1.1rem; color:#555;">è¨­è¨ˆæµé‡ (Q<sub>design</sub>)</span>
                            <span class="result-val xl" id="resQdesign">0 CMD</span>
                        </div>
                        <div style="text-align:right; color:#999; margin-top:5px; font-size:0.9rem;">( ç´„ <span id="resQdesignCMS">0</span> CMS )</div>
                    </div>
                </div>
            </div>

            <div id="tab2" class="inner-tab-content">
                <div class="chapter-body">
                    <button class="login-btn" onclick="importFlowToTab('tab2')" style="background:var(--color-sage); font-size:0.9rem; padding:8px 20px; margin-bottom:20px;">â¬‡ å¸¶å…¥ Tab 1 æµé‡çµæœ</button>
                    
                    <div class="calc-grid">
                        <div>
                            <span class="calc-label">è¨­è¨ˆæµé‡ Q</span>
                            <div style="display:flex; gap:10px;">
                                <input type="number" id="hydQ" class="login-input" style="flex:2; margin:0;" step="0.001">
                                <select id="hydQUnit" class="login-input" style="flex:1; margin:0;">
                                    <option value="CMD">CMD</option>
                                    <option value="CMS">CMS</option>
                                </select>
                            </div>
                        </div>
                        <div><span class="calc-label">ç®¡å¾‘ D (mm)</span><input type="number" id="hydD" class="login-input" value="700" step="50" style="margin:0;"></div>
                        <div><span class="calc-label">å¡åº¦ S (%)</span><input type="number" id="hydS" class="login-input" value="0.8" step="0.01" style="margin:0;"></div>
                        <div><span class="calc-label">æ›¼å¯§ n å€¼</span><input type="number" id="hydN" class="login-input" value="0.015" step="0.001" style="margin:0;"></div>
                    </div>

                    <button class="login-btn" onclick="calculateSinglePipe()" style="width:100%; background:var(--color-sage); margin-top:20px;">é–‹å§‹æª¢æ ¸ Check</button>

                    <div id="hydResultBox" class="result-card" style="display:none; background:#F0FDF4; border-color:#86EFAC;">
                        <h4 style="margin-top:0; color:#15803D;">æª¢æ ¸çµæœ</h4>
                        <div class="result-row"><span>æ»¿ç®¡æµé€Ÿ (V<sub>full</sub>)</span><span class="result-val" id="resVfull"></span></div>
                        <div class="result-row"><span>æ»¿ç®¡æµé‡ (Q<sub>full</sub>)</span><span class="result-val" id="resQfull"></span></div>
                        <div class="result-row"><span>æµé‡æ¯” (Q/Q<sub>f</sub>)</span><span class="result-val" id="resRatioQ"></span></div>
                        <div class="result-row"><span>æ°´æ·±æ¯” (h/D)</span><span class="result-val" id="resRatioH"></span></div>
                        <div class="result-row highlight">
                            <span>è¨­è¨ˆæµé€Ÿ (V)</span>
                            <span class="result-val xl" style="color:#15803D;" id="resVdesign"></span>
                        </div>
                        <div style="margin-top:15px; padding:10px; background:white; border-radius:10px; text-align:center;" id="resStatus"></div>
                    </div>
                </div>
            </div>

            <div id="tab3" class="inner-tab-content">
                <div class="chapter-body">
                    <button class="login-btn" onclick="importFlowToTab('tab3')" style="background:var(--color-sand); font-size:0.9rem; padding:8px 20px; margin-bottom:20px;">â¬‡ å¸¶å…¥ Tab 1 æµé‡çµæœ</button>
                    
                    <div class="calc-grid">
                        <div>
                            <span class="calc-label">è¨­è¨ˆæµé‡ Q</span>
                            <div style="display:flex; gap:10px;">
                                <input type="number" id="quickQ" class="login-input" style="flex:2; margin:0;" step="0.001">
                                <select id="quickQUnit" class="login-input" style="flex:1; margin:0;">
                                    <option value="CMD">CMD</option>
                                    <option value="CMS">CMS</option>
                                </select>
                            </div>
                        </div>
                        <div><span class="calc-label">æ›¼å¯§ n å€¼</span><input type="number" id="quickN" class="login-input" value="0.015" style="margin:0;"></div>
                    </div>

                    <div class="note-box" style="margin:20px 0; background:#FEFBEA; border-color:var(--color-sand);">
                        <div style="font-weight:700; color:var(--color-sand); margin-bottom:10px;">é™åˆ¶æ¢ä»¶ (Constraints)</div>
                        <div style="display:flex; align-items:center; gap:10px; flex-wrap:wrap;">
                            <span>æµé€Ÿç¯„åœï¼š</span>
                            <input type="number" id="limVmin" value="0.6" style="width:70px; padding:5px; border:1px solid #ddd; border-radius:5px; text-align:center;">
                            <span>~</span>
                            <input type="number" id="limVmax" value="3.0" style="width:70px; padding:5px; border:1px solid #ddd; border-radius:5px; text-align:center;">
                            <span>m/s</span>
                        </div>
                        <div style="font-size:0.85rem; color:#666; margin-top:10px;">
                            è‡ªå‹•æª¢æ ¸æ°´æ·±æ¯”ï¼šç®¡å¾‘ &le; 500mm é™ 0.5ï¼›ç®¡å¾‘ &ge; 600mm é™ 0.8
                        </div>
                    </div>

                    <button class="login-btn" onclick="runQuickCheck()" style="width:100%; background:var(--color-sand);">ç”Ÿæˆé€ŸæŸ¥è¡¨ Generate</button>

                    <div id="quickCheckResult" style="display:none; overflow-x:auto; margin-top:20px;">
                        <table class="quick-table">
                            <thead>
                                <tr>
                                    <th>ç®¡å¾‘ (mm)</th>
                                    <th>å¯è¡Œå¡åº¦ç¯„åœ (%)</th>
                                    <th>é™åˆ¶æ¢ä»¶</th>
                                    <th>æµé€Ÿç¯„åœ (m/s)</th>
                                </tr>
                            </thead>
                            <tbody id="quickCheckBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <section id="view-tools" class="view-section">
            <header>
                <div style="font-size:0.9rem; color:var(--color-sand); font-weight:700; margin-bottom:10px;">RESOURCE LIBRARY</div>
                <h1 style="font-size:2.5rem; font-family:'DM Serif Display';">System <span style="color:var(--color-sage);">Manuals</span></h1>
            </header>
            <div class="tab-nav">
                <button class="tab-btn active" onclick="loadMarkdown('QGIS.md', this)">QGIS</button>
                <button class="tab-btn" onclick="loadMarkdown('CODiS æ°£å€™è§€æ¸¬è³‡æ–™æŸ¥è©¢æœå‹™.md', this)">æ°£å€™è§€æ¸¬</button>
                <button class="tab-btn" onclick="loadMarkdown('å…§æ”¿éƒ¨-é–€ç‰Œé›»å­åœ°åœ–æŸ¥è©¢ç³»çµ±.md', this)">é–€ç‰Œåœ°åœ–</button>
                <button class="tab-btn" onclick="loadMarkdown('å…¬è·¯äº¤é€šé‡èª¿æŸ¥çµ±è¨ˆåœ°åœ–.md', this)">å…¬è·¯äº¤é€šé‡</button>
                <button class="tab-btn" onclick="loadMarkdown('å…¨åœ‹åœ°æ”¿é›»å­è¬„æœ¬ç³»çµ±.md', this)">åœ°æ”¿è¬„æœ¬</button>
                <button class="tab-btn" onclick="loadMarkdown('å…¨åœ‹æ©‹æ¢çµ±è¨ˆè³‡è¨Šç¶².md', this)">æ©‹æ¢çµ±è¨ˆ</button>
                <button class="tab-btn" onclick="loadMarkdown('å…¨åœ‹ç’°å¢ƒæ°´è³ªç›£æ¸¬è³‡è¨Šç¶².md', this)">æ°´è³ªç›£æ¸¬</button>
                <button class="tab-btn" onclick="loadMarkdown('åœ°ç±åœ–è³‡ç¶²è·¯ä¾¿æ°‘æœå‹™ç³»çµ±.md', this)">åœ°ç±åœ–è³‡</button>
                <button class="tab-btn" onclick="loadMarkdown('åœ‹åœŸæ¸¬ç¹ªä¸­å¿ƒåœ–è³‡æœå‹™é›².md', this)">åœ‹åœŸæ¸¬ç¹ª</button>
                <button class="tab-btn" onclick="loadMarkdown('è‡ºå—å¸‚é“è·¯æŒ–æ˜ç³»çµ±.md', this)">å—å¸‚é“è·¯æŒ–æ˜</button>
            </div>
            <div id="markdown-container">
                <p style="color:#aaa;">è«‹é»æ“Šä¸Šæ–¹æŒ‰éˆ•è¼‰å…¥èªªæ˜æ–‡ä»¶...</p>
            </div>
        </section>

        <section id="view-phase1" class="view-section">
            <header>
                <div style="font-size:0.9rem; color:var(--color-rose); font-weight:700; margin-bottom:10px; letter-spacing:1px;">LEARNING MODULE</div>
                <h1>Phase 01: <br><span>Project Initiation</span></h1>
            </header>
            <article>
                <div class="chapter-header"><div style="font-size:1.8rem; font-weight:700; font-family:'DM Serif Display';">ä¸Šä½è¨ˆç•«é«”ç³»èˆ‡ç™¼åŒ…æ±ºç­–</div></div>
                <div class="chapter-body">
                    <p>å·¥ç¨‹çš„æˆæ•—ï¼Œå¾€å¾€åœ¨ã€Œé–‹å·¥å‰ã€å°±æ±ºå®šäº†ã€‚ä¾æ“š<strong>ã€Šä¸‹æ°´é“æ³•ã€‹</strong>ï¼Œå»ºè¨­å…·æœ‰åš´æ ¼çš„æ³•å®šç¨‹åºã€‚</p>
                    <h3>1.1 ä¸Šä½è¨ˆç•«çš„å±¤ç´šé«”ç³»</h3>
                    <div class="note-box">
                        <h4>å±¤ç´šä¸€ï¼š<span class="def-link" onclick="openDef('masterplan')">æ±¡æ°´ä¸‹æ°´é“ç³»çµ±è¦åŠƒ</span> (Master Plan)</h4>
                        <p><strong>1. æ³•è¦å®šç¾©ï¼š</strong>ä¾ä¸‹æ°´é“æ³•ç¬¬5æ¢ï¼Œç‚ºä¿è­·æ°´åŸŸæ°´è³ªåŠè³‡æºå¾ªç’°åˆ©ç”¨ã€‚</p>
                        <p><strong>2. è¦åŠƒç›®æ¨™å¹´ (Target Year)ï¼š</strong>é€šå¸¸è¨­å®šç‚º <span style="font-weight:700; color:var(--text-title);">20~30 å¹´</span>ã€‚è€ƒé‡åœŸæœ¨è¨­æ–½è€ç”¨å¹´æ•¸ç´„ 50 å¹´ï¼Œä¸”ç®¡ç·šåŸ‹è¨­å¾Œæ“´å»ºå›°é›£ï¼Œé•·æœŸè¦åŠƒå¯é¿å…ç®¡å¾‘è¨­è¨ˆéå°ã€‚</p>
                        <p><strong>3. ç³»çµ±é‚Šç•Œï¼š</strong>éœ€ä¾æ•ˆç›ŠåŠƒåˆ†ã€Œå…¬å…±ä¸‹æ°´é“ã€(äººå£å¯†é›†)ã€ã€Œå°ˆç”¨ä¸‹æ°´é“ã€èˆ‡ã€Œå»ºç¯‰ç‰©æ±¡æ°´è™•ç†è¨­æ–½ã€(åˆ†æ•£èšè½)ã€‚</p>
                        <hr style="border:0; border-top:1px dashed #ddd; margin:20px 0;">
                        <h4>å±¤ç´šäºŒï¼š<span class="def-link" onclick="openDef('implplan')">å¯¦æ–½è¨ˆç•«</span> (Implementation Plan)</h4>
                        <p><strong>1. è¡Œæ”¿å®šä½ï¼š</strong>çˆ­å–ä¸­å¤®è£œåŠ©çš„è«‹æ¬¾ä¾æ“šã€‚éœ€æ ¸å®šå¾Œæ“šä»¥å¯¦æ–½ã€‚</p>
                        <p><strong>2. åˆ†æœŸå»ºè¨­åŸå‰‡ï¼š</strong>ç‚ºé”ç¶“æ¿Ÿæ•ˆç›Šèˆ‡é…åˆé ç®—ï¼š<br>â€¢ å¤§è¦æ¨¡ (>30,000 CMD)ï¼šåŸå‰‡åˆ†ä¸‰æœŸã€‚<br>â€¢ ä¸­è¦æ¨¡ (10,000~30,000 CMD)ï¼šåŸå‰‡åˆ†äºŒæœŸã€‚</p>
                        <p><strong>3. é¢¨éšªç®¡æ§ï¼š</strong>è¨­è¨ˆæ™‚éœ€æª¢è¨åŸè¦åŠƒï¼Œè€ƒé‡äººå£è®ŠåŒ–ï¼Œä»¥å…è¨­æ–½ä¸ç¶“æ¿Ÿã€‚</p>
                    </div>
                    <h3>1.2 å‹å‹™æ¡è³¼ç­–ç•¥ï¼šç‚ºä½•æ¡ç”¨ <span class="def-link" onclick="openDef('ds')">D&S (è¨­è¨ˆç›£é€ åˆä½µ)</span>ï¼Ÿ</h3>
                    <div class="risk-box" style="background:var(--color-sage-light); border-color:#CCFBF1;">
                        <span style="font-weight:700; color:var(--color-sage); display:block; margin-bottom:10px; font-size:1.1rem;">è«–è¿°ä¸€ï¼šè§£æ±ºã€Œåœ°ä¸‹å·¥ç¨‹ä¸å¯é è¦‹æ€§ã€çš„è²¬ä»»æ­¸å±¬</span>
                        <ul style="list-style:none; padding-left:0; margin:0;">
                            <li style="margin-bottom:8px;"><strong>â€¢ æ·±åŸ‹é¢¨éšªï¼š</strong>ç®¡æ¸ åŸ‹æ·±é” <span style="font-weight:700;">3~15m</span>ï¼Œå¸¸é‡åœ°å½¢ã€æ²³å·ã€åœ°è³ªè®Šç•°ã€‚</li>
                            <li style="margin-bottom:8px;"><strong>â€¢ <span class="def-link" onclick="openDef('trialpit')">è©¦æŒ–</span>ä¿®æ­£ï¼š</strong>è¨­è¨ˆéšæ®µéœ€è©¦æŒ–ã€æ‹ç…§ä¸¦ <span class="def-link" onclick="openDef('gis')">GIS å»ºæª”</span>ï¼Œä»¥ç¢ºä¿å·¥ä½œäº•ä¸è¡çªã€‚</li>
                            <li><strong>â€¢ å¿«é€Ÿè®Šæ›´ï¼š</strong>åˆä½µæ‹›æ¨™èƒ½ä¾æ“šè©¦æŒ–æˆæœï¼Œå¿«é€Ÿä¿®æ­£ç®¡ç·šé…ç½®ã€‚</li>
                        </ul>
                    </div>
                </div>
            </article>
        </section>

        <section id="view-phase2" class="view-section">
            <header>
                <div style="font-size:0.9rem; color:var(--color-sage); font-weight:700; margin-bottom:10px; letter-spacing:1px;">LEARNING MODULE</div>
                <h1>Phase 02: <br><span style="color:var(--color-sage);">Investigation</span></h1>
            </header>
            <article>
                <div class="chapter-header" style="background:var(--color-sage-light); border-bottom:1px dashed #CCFBF1;">
                    <div style="font-size:1.8rem; font-weight:700; font-family:'DM Serif Display'; color:var(--color-sage);">ç’°å¢ƒèƒŒæ™¯èª¿æŸ¥èˆ‡è³‡è¨ŠæŸ¥è©¢</div>
                </div>
                <div class="chapter-body">
                    <p>æ­¤éšæ®µæ˜¯å·¥ç¨‹é¢¨éšªç®¡ç†çš„ã€Œé˜²ç«ç‰†ã€ã€‚é€éç§‘å­¸èª¿æŸ¥ï¼Œå°‡ã€ŒæœªçŸ¥é¢¨éšªã€è½‰åŒ–ç‚ºã€Œå·²çŸ¥æ¢ä»¶ã€ã€‚</p>
                    <h3>2.1 å¿…å‚™è³‡æ–™èˆ‡é¢¨éšªè«–è¿°</h3>
                    <div class="table-container">
                        <table class="styled-table">
                            <thead><tr><th>é …ç›®</th><th>åŸ·è¡Œæ–¹å¼ / é¢¨éšª</th></tr></thead>
                            <tbody>
                                <tr><td>åœ°ä¸‹ç®¡ç·š</td><td>ç™¼æ–‡èª¿é–± + å”èª¿æœƒ + <strong>ç¾å ´è©¦æŒ–</strong>ã€‚</td></tr>
                                <tr><td>åœ°è³ªæ¢ä»¶</td><td>ç¾åœ°é‘½æ¢ (Dæ¨™å…±30å­”)ã€‚<span class="def-link" onclick="openDef('nvalue')">Nå€¼</span>æ±ºå®šå·¥æ³•ã€‚</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </article>
        </section>

        <section id="view-phase3" class="view-section">
            <header>
                <div style="font-size:0.9rem; color:#D4A373; font-weight:700; margin-bottom:10px; letter-spacing:1px;">LEARNING MODULE</div>
                <h1>Phase 03: <br><span style="color:#D4A373;">Design Criteria</span></h1>
            </header>
            <article>
                <div class="chapter-header" style="background:#FEFBEA; border-bottom:1px dashed #FCEBB6;">
                    <div style="font-size:1.8rem; font-weight:700; font-family:'DM Serif Display'; color:#D4A373;">è¨­è¨ˆæº–å‰‡èˆ‡æŠ€è¡“æ±ºç­–</div>
                </div>
                <div class="chapter-body">
                    <p>æ ¸å¿ƒåœ¨æ–¼ã€Œæ­£ç¢ºé ä¼°æµé‡ã€ä¸¦ã€Œæä¾›å®‰å…¨è¼¸é€èƒ½åŠ›ã€ã€‚</p>
                    <h3>3.1 æµé‡èˆ‡æ°´åŠ›è¨­è¨ˆ</h3>
                    <p>ä¾æ“šã€Šä¸‹æ°´é“ç³»çµ±è¨­è¨ˆåŠè§£èªªã€‹ï¼Œå¿…é ˆä»¥<strong><span class="def-link" onclick="openDef('qmax')">è¨ˆç•«æœ€å¤§æ—¥æ±¡æ°´é‡ ($Q_{max}$)</span></strong> ä½œç‚ºè¨­è¨ˆåŸºç¤ã€‚</p>
                    <div class="math-box">$$Q_{max} = Q_{avg} \times PF + Q_{inf}$$</div>
                    <div class="note-box">
                        <h4>1. è¨ˆç•«äººå£ ($P$)</h4>
                        <p>ä¸èƒ½åƒ…çœ‹ç¾æ³ï¼Œéœ€ä¾éƒ½å¸‚è¨ˆç•«é£½å’Œå¯†åº¦æ¨ä¼°ã€‚</p>
                        <hr style="border:0; border-top:1px dashed #ddd; margin:15px 0;">
                        <h4>2. <span class="def-link" onclick="openDef('lpcd')">å–®ä½æ±¡æ°´é‡ ($q$)</span></h4>
                        <p>$250 \text{ (LPCD)} \times 0.9 \text{ (è½‰æ›ç‡)} = \mathbf{225 \text{ LPCD}}$</p>
                    </div>
                </div>
            </article>
        </section>

        <section id="view-phase4" class="view-section">
            <header>
                <div style="font-size:0.9rem; color:#5C5C5C; font-weight:700; margin-bottom:10px; letter-spacing:1px;">LEARNING MODULE</div>
                <h1>Phase 04: <br><span style="color:#5C5C5C;">Construction Planning</span></h1>
            </header>
            <article>
                <div class="chapter-header" style="background:#F3F4F6; border-bottom:1px dashed #E5E7EB;">
                    <div style="font-size:1.8rem; font-weight:700; font-family:'DM Serif Display'; color:#2D2D2D;">æ–½å·¥æ–¹æ¡ˆèˆ‡éšœç¤™æ’é™¤</div>
                </div>
                <div class="chapter-body">
                    <div class="tab-nav">
                        <button class="tab-btn active" onclick="switchInnerTab('p4-tab1', this)">ç®¡ç·šéšœç¤™</button>
                        <button class="tab-btn" onclick="switchInnerTab('p4-tab2', this)">äº¤é€šç¶­æŒ</button>
                    </div>
                    <div id="p4-tab1" class="inner-tab-content active">
                        <h3>4.1 åœ°ä¸‹ç®¡ç·šéšœç¤™è™•ç†</h3>
                        <div class="note-box" style="border-left-color:#5C5C5C;">
                            <h4>4.1.1 ç®¡ç·šè¡çªè™•ç†åŸå‰‡</h4>
                            <p><strong>ç¬¬ä¸€ç´šï¼šä¸å¯é·ç§»</strong> - é‡åŠ›æµç®¡ç·š(é›¨æ°´ç®±æ¶µ)ã€ç‰¹é«˜å£“é›»ã€‚</p>
                        </div>
                    </div>
                    <div id="p4-tab2" class="inner-tab-content">
                        <h3>4.2 äº¤é€šç¶­æŒè¨ˆç•«</h3>
                        <p>éœ€ä¾æ“š<span class="def-link" onclick="openDef('los')">é“è·¯æœå‹™æ°´æº– (LOS)</span> æ±ºç­–ã€‚</p>
                    </div>
                </div>
            </article>
        </section>

        <section id="view-phase5" class="view-section">
            <header>
                <div style="font-size:0.9rem; color:#84A98C; font-weight:700; margin-bottom:10px; letter-spacing:1px;">LEARNING MODULE</div>
                <h1>Phase 05: <br><span style="color:#84A98C;">Sustainability</span></h1>
            </header>
            <article>
                <div class="chapter-header" style="background:#F0FDF4; border-bottom:1px dashed #BBF7D0;">
                    <div style="font-size:1.8rem; font-weight:700; font-family:'DM Serif Display'; color:#355E3B;">ç’°å¢ƒä¿è­·èˆ‡ç¯€èƒ½æ¸›ç¢³</div>
                </div>
                <div class="chapter-body">
                    <p>åœ¨ ESG æŒ‡æ¨™ç´å…¥è©•ä¼°å¾Œï¼Œç’°ä¿å·²æ˜¯æ ¸å¿ƒåƒ¹å€¼ã€‚</p>
                    <h3>5.1 ç”Ÿæ…‹æª¢æ ¸</h3>
                    <p>ä¾æ“šã€Œå…¬å…±å·¥ç¨‹ç”Ÿæ…‹æª¢æ ¸æ³¨æ„äº‹é …ã€ï¼ŒåŸ·è¡Œæ¨™æº–åŒ–æ±ºç­–æµç¨‹ã€‚</p>
                </div>
            </article>
        </section>

    </main>

<script>
    // ==========================================
    // â˜…â˜…â˜… å¯†ç¢¼é–é‚è¼¯ â˜…â˜…â˜…
    // ==========================================
    const CORRECT_PASSWORD = "beautyyuna";
    document.getElementById("password-input").addEventListener("keypress", function(event) {
        if (event.key === "Enter") { checkPassword(); }
    });
    function checkPassword() {
        const input = document.getElementById("password-input").value;
        const overlay = document.getElementById("login-overlay");
        const box = document.getElementById("login-box");
        if (input === CORRECT_PASSWORD) {
            overlay.style.opacity = "0"; overlay.style.visibility = "hidden";
        } else {
            box.classList.add("shake");
            document.getElementById("password-input").value = "";
            setTimeout(() => { box.classList.remove("shake"); }, 500);
        }
    }

    // ==========================================
    // â˜…â˜…â˜… Markdown è™•ç† (åŒ…å«å´é‚Šç›®éŒ„ TOC) â˜…â˜…â˜…
    // ==========================================
    const renderer = {
        image(href, title, text) {
            if (href && !href.startsWith('http') && !href.startsWith('notes/')) {
                href = 'notes/æ‰€æœ‰åœ–ç‰‡/' + href;
            }
            return `<img src="${href}" alt="${text}">`;
        }
    };
    marked.use({ renderer });

    function loadMarkdown(filename, btnElement) {
        const container = document.getElementById('markdown-container');
        const path = './notes/' + filename; 
        if(btnElement) {
            document.querySelectorAll('#view-tools .tab-btn').forEach(btn => btn.classList.remove('active'));
            btnElement.classList.add('active');
        }
        container.innerHTML = '<p style="color:#aaa;">Loading content...</p>';
        fetch(path)
            .then(response => {
                if (!response.ok) throw new Error("æ‰¾ä¸åˆ°æª”æ¡ˆ");
                return response.text();
            })
            .then(text => {
                text = text.replace(/!\[\[([^|\]]+)(?:\|[^\]]*)?\]\]/g, (match, filename) => {
                    return `<img src="notes/æ‰€æœ‰åœ–ç‰‡/${filename}" alt="${filename}">`;
                });
                let parsedHTML = marked.parse(text);
                
                // åŠ å…¥ TOC æ¶æ§‹
                container.innerHTML = `
                    <div class="md-layout">
                        <div class="md-content" id="md-content-body">${parsedHTML}</div>
                        <div class="md-toc">
                            <h4>Table of Contents</h4>
                            <ul class="toc-list" id="toc-list"></ul>
                        </div>
                    </div>
                `;
                generateTOC(); // å‘¼å«ç›®éŒ„ç”Ÿæˆ
                if(window.MathJax) MathJax.typesetPromise([container]);
            })
            .catch(err => {
                console.error(err);
                container.innerHTML = `<p style="color:red;">è®€å–å¤±æ•—ï¼šç„¡æ³•è¼‰å…¥ <b>${filename}</b><br>è«‹ç¢ºèªæª”æ¡ˆæ˜¯å¦å·²æ”¾å…¥ã€notesã€‘è³‡æ–™å¤¾ä¸­ã€‚</p>`;
            });
    }

    function generateTOC() {
        const content = document.getElementById('md-content-body');
        const tocList = document.getElementById('toc-list');
        const headers = content.querySelectorAll('h1, h2, h3');
        if (headers.length === 0) { document.querySelector('.md-toc').style.display = 'none'; return; }
        headers.forEach((header, index) => {
            if (!header.id) header.id = 'header-' + index;
            const li = document.createElement('li');
            li.className = 'toc-item';
            if (header.tagName === 'H2') li.classList.add('toc-h2');
            if (header.tagName === 'H3') li.classList.add('toc-h3');
            const link = document.createElement('a');
            link.className = 'toc-link';
            link.href = '#' + header.id;
            link.innerText = header.innerText;
            link.onclick = (e) => {
                e.preventDefault();
                header.scrollIntoView({ behavior: 'smooth', block: 'start' });
                document.querySelectorAll('.toc-link').forEach(el => el.classList.remove('active'));
                link.classList.add('active');
            };
            li.appendChild(link);
            tocList.appendChild(li);
        });
    }

    // ==========================================
    // â˜…â˜…â˜… å®Œæ•´ä¸”æœªåˆªæ¸›çš„æ°´ç†è¨ˆç®—æ©Ÿé‚è¼¯ â˜…â˜…â˜…
    // ==========================================
    let globalDesignFlowCMS = 0; 

    // è¨ˆç®—æ©Ÿ Tab åˆ‡æ›
    function switchCalcTab(tabId, btn) {
        const parent = document.getElementById('view-calculator');
        parent.querySelectorAll('.inner-tab-content').forEach(el => el.classList.remove('active'));
        parent.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        btn.classList.add('active');
    }

    // äººå£æ¨¡å¼åˆ‡æ›
    function togglePopMode() {
        const mode = document.querySelector('input[name="popMode"]:checked').value;
        if (mode === 'direct') {
            document.getElementById('popInputDirect').style.display = 'block';
            document.getElementById('popInputDensity').style.display = 'none';
        } else {
            document.getElementById('popInputDirect').style.display = 'none';
            document.getElementById('popInputDensity').style.display = 'block';
        }
    }

    // å¸¶å…¥æµé‡æŒ‰éˆ•
    function importFlowToTab(tab) {
        if (globalDesignFlowCMS === 0) { alert("è«‹å…ˆåœ¨ã€Tab 1ã€‘è¨ˆç®—æµé‡ï¼"); return; }
        let targetId = (tab === 'tab2') ? 'hydQ' : 'quickQ';
        let unitId = (tab === 'tab2') ? 'hydQUnit' : 'quickQUnit';
        let unit = document.getElementById(unitId).value;
        let val = (unit === 'CMS') ? globalDesignFlowCMS : globalDesignFlowCMS * 86400;
        document.getElementById(targetId).value = parseFloat(val.toFixed(4));
    }

    // --- æ ¸å¿ƒæ•¸å­¸å¼•æ“ ---
    function getGeoElements(theta) {
        if (theta <= 0) return { a:0, r:0 };
        if (theta >= 2*Math.PI) return { a:1, r:1 };
        let ratioA = (theta - Math.sin(theta)) / (2 * Math.PI);
        let ratioR = 1 - Math.sin(theta) / theta;
        return { a: ratioA, r: ratioR };
    }

    function solveManning(Q, D, S, n) {
        const A_full = Math.PI * Math.pow(D/2, 2);
        const R_full = D/4;
        const V_full = (1/n) * Math.pow(R_full, 2/3) * Math.pow(S, 0.5);
        const Q_full = A_full * V_full;
        if (Q >= Q_full) return { v: V_full, h: 1.0, qRatio: Q/Q_full, status: "çˆ†ç®¡ (Q>Qfull)" };
        const ratioQ = Q / Q_full;
        let low = 0, high = 2 * Math.PI, theta = 0;
        for(let i=0; i<30; i++) {
            theta = (low+high)/2;
            let geo = getGeoElements(theta);
            let calcRatio = geo.a * Math.pow(geo.r, 2/3);
            if (calcRatio < ratioQ) low = theta; else high = theta;
        }
        let geoFinal = getGeoElements(theta);
        let h_d = (1 - Math.cos(theta/2)) / 2;
        let v_part = V_full * Math.pow(geoFinal.r, 2/3);
        return { v: v_part, h: h_d, qRatio: ratioQ, status: "OK" };
    }

    // --- TAB 1 é‚è¼¯ (å®Œå…¨ä¿ç•™) ---
    function calculateFlow() {
        // 1. äººå£
        const mode = document.querySelector('input[name="popMode"]:checked').value;
        let pop = 0;
        if (mode === 'direct') {
            pop = parseFloat(document.getElementById('population').value) || 0;
        } else {
            const resA = parseFloat(document.getElementById('resArea').value) || 0;
            const resD = parseFloat(document.getElementById('resDensity').value) || 0;
            const comA = parseFloat(document.getElementById('comArea').value) || 0;
            const comD = parseFloat(document.getElementById('comDensity').value) || 0;
            pop = (resA * resD) + (comA * comD);
            document.getElementById('calcPopResult').innerText = pop.toLocaleString();
        }

        // 2. åƒæ•¸
        const lpcd = parseFloat(document.getElementById('lpcd').value)||0;
        const infRate = parseFloat(document.getElementById('infiltrationRate').value)||0;
        
        let others = 0;
        // ç¢ºä¿è®€å–æ‰€æœ‰åˆ†å€
        others += (parseFloat(document.getElementById('indArea').value)||0) * (parseFloat(document.getElementById('indUnit').value)||0);
        others += (parseFloat(document.getElementById('govArea').value)||0) * (parseFloat(document.getElementById('govUnit').value)||0);
        others += (parseFloat(document.getElementById('schArea').value)||0) * (parseFloat(document.getElementById('schUnit').value)||0);
        others += (parseFloat(document.getElementById('parkArea').value)||0) * (parseFloat(document.getElementById('parkUnit').value)||0);

        // 3. è¨ˆç®—
        const qDom = pop * lpcd / 1000;
        const qBase = qDom + others;
        const qInf = qBase * (infRate / 100);
        const qAvg = qBase + qInf; // å¹³å‡æ—¥
        
        // 4. PF
        let popForPF = (lpcd > 0) ? (qBase * 1000) / lpcd : 0;
        const pK = popForPF / 1000;
        let pf = 1.5;
        if (pK > 0) pf = (18 + Math.sqrt(pK)) / (4 + Math.sqrt(pK));

        // 5. çµæœ
        const qDesign = qBase * pf + qInf;
        globalDesignFlowCMS = qDesign / 86400;

        document.getElementById('calcBaseFlow').innerText = qBase.toLocaleString(undefined, {maximumFractionDigits:2}) + " CMD";
        document.getElementById('calcInfFlow').innerText = qInf.toLocaleString(undefined, {maximumFractionDigits:2}) + " CMD";
        document.getElementById('resQavg').innerText = qAvg.toLocaleString(undefined, {maximumFractionDigits:2}) + " CMD";
        document.getElementById('resPopPF').innerText = popForPF.toLocaleString(undefined, {maximumFractionDigits:0}) + " äºº";
        document.getElementById('resPF').innerText = pf.toFixed(4);
        document.getElementById('resQdesign').innerText = qDesign.toLocaleString(undefined, {maximumFractionDigits:2}) + " CMD";
        document.getElementById('resQdesignCMS').innerText = globalDesignFlowCMS.toFixed(4);
    }

    // --- TAB 2 é‚è¼¯ ---
    function calculateSinglePipe() {
        const qVal = parseFloat(document.getElementById('hydQ').value);
        const qUnit = document.getElementById('hydQUnit').value;
        const D_mm = parseFloat(document.getElementById('hydD').value);
        const S_pct = parseFloat(document.getElementById('hydS').value);
        const n = parseFloat(document.getElementById('hydN').value);

        if(!qVal || !D_mm || !S_pct) return;

        let Q_cms = (qUnit==='CMD') ? qVal/86400 : qVal;
        let res = solveManning(Q_cms, D_mm/1000, S_pct/100, n);

        const A_full = Math.PI * Math.pow(D_mm/2000, 2);
        const V_full = (1/n) * Math.pow(D_mm/4000, 2/3) * Math.pow(S_pct/100, 0.5);
        const Q_full = A_full * V_full;

        document.getElementById('resQfull').innerText = Q_full.toFixed(3) + " CMS";
        document.getElementById('resVfull').innerText = V_full.toFixed(3) + " m/s";
        document.getElementById('resRatioQ').innerText = (res.qRatio*100).toFixed(2) + " %";
        document.getElementById('resRatioH').innerText = res.h.toFixed(3);
        document.getElementById('resVdesign').innerText = res.v.toFixed(3) + " m/s";

        let msgs = [];
        let strictH = (D_mm <= 500) ? 0.5 : 0.8;
        let statusColor = "color:#6BCB77"; // Green

        if (res.status !== "OK") { 
            msgs.push(res.status); statusColor = "color:#FF6B6B"; 
        } else {
            if (res.v < 0.6) { msgs.push("âš ï¸ æµé€Ÿéä½ (<0.6)"); statusColor = "color:#FFD93D"; }
            if (res.v > 3.0) { msgs.push("âš ï¸ æµé€Ÿéé«˜ (>3.0)"); statusColor = "color:#FFD93D"; }
            if (res.h > strictH) { msgs.push(`âš ï¸ æ°´æ·±æ¯”éé«˜ (>${strictH})`); statusColor = "color:#FFD93D"; }
        }
        if (msgs.length===0) msgs.push("âœ… ç¬¦åˆæ¨™æº– (OK)");
        document.getElementById('resStatus').innerHTML = `<strong style="${statusColor}">${msgs.join("<br>")}</strong>`;
        document.getElementById('hydResultBox').style.display = 'block';
    }

    // --- TAB 3 é‚è¼¯ ---
    function runQuickCheck() {
        const qVal = parseFloat(document.getElementById('quickQ').value);
        const qUnit = document.getElementById('quickQUnit').value;
        const vMin = parseFloat(document.getElementById('limVmin').value);
        const vMax = parseFloat(document.getElementById('limVmax').value);
        const n = parseFloat(document.getElementById('quickN').value) || 0.015;

        if (!qVal) { alert("è«‹è¼¸å…¥è¨­è¨ˆæµé‡"); return; }
        let Q = (qUnit==='CMD') ? qVal/86400 : qVal;

        const pipes = [200, 250, 300, 350, 400, 450, 500, 600, 700, 800, 900, 1000, 1100, 1200, 1350, 1500, 1650, 1800, 2000, 2200, 2400];
        let tbody = document.getElementById('quickCheckBody');
        tbody.innerHTML = "";
        let hasResult = false;

        pipes.forEach(D_mm => {
            let D = D_mm / 1000;
            let hMax = (D_mm <= 500) ? 0.5 : 0.8;
            let validSlopes = [];
            
            for (let s_check = 0.0005; s_check <= 0.06; s_check += 0.0005) {
                let res = solveManning(Q, D, s_check, n);
                if (res.status === "OK") {
                    if (res.v >= vMin && res.v <= vMax && res.h <= hMax) {
                        validSlopes.push(s_check);
                    }
                }
            }

            if (validSlopes.length > 0) {
                let minS = Math.min(...validSlopes) * 100;
                let maxS = Math.max(...validSlopes) * 100;
                let row = `<tr>
                    <td style="font-weight:800; color:var(--text-title);">${D_mm}</td>
                    <td style="font-family:'Nunito'; color:var(--color-sage); font-weight:bold;">${minS.toFixed(2)}% ~ ${maxS.toFixed(2)}%</td>
                    <td><span class="status-badge status-green">h/D &le; ${hMax}</span></td>
                    <td style="font-size:0.9em; color:#666;">${vMin}~${vMax}</td>
                </tr>`;
                tbody.innerHTML += row;
                hasResult = true;
            }
        });

        if (!hasResult) {
            tbody.innerHTML = `<tr><td colspan="4" style="color:#999; padding:20px;">ç„¡åˆé©ç®¡å¾‘ï¼Œè«‹èª¿æ•´æµé‡æˆ–æµé€Ÿé™åˆ¶ã€‚</td></tr>`;
        }
        document.getElementById('quickCheckResult').style.display = 'block';
    }

    // ç›£è½äººå£æ›´æ–°
    ['resArea', 'resDensity', 'comArea', 'comDensity'].forEach(id => {
        document.getElementById(id).addEventListener('input', function() {
            if (document.querySelector('input[name="popMode"]:checked').value === 'density') {
                const resA = parseFloat(document.getElementById('resArea').value) || 0;
                const resD = parseFloat(document.getElementById('resDensity').value) || 0;
                const comA = parseFloat(document.getElementById('comArea').value) || 0;
                const comD = parseFloat(document.getElementById('comDensity').value) || 0;
                const pop = (resA * resD) + (comA * comD);
                document.getElementById('calcPopResult').innerText = pop.toLocaleString();
            }
        });
    });

    // å°èˆªèˆ‡åŠŸèƒ½
    const glossary = {
        "masterplan": { title: "æ±¡æ°´ä¸‹æ°´é“ç³»çµ±è¦åŠƒ (Master Plan)", desc: "éƒ½å¸‚æ±¡æ°´è™•ç†çš„æœ€é«˜æŒ‡å°åŸå‰‡èˆ‡é•·æœŸé¡˜æ™¯..." },
        "implplan": { title: "å¯¦æ–½è¨ˆç•« (Implementation Plan)", desc: "ä¾æ“šç³»çµ±è¦åŠƒåˆ¶å®šçš„å…·é«”åŸ·è¡Œæ–¹æ¡ˆ..." },
        "ds": { title: "è¨­è¨ˆç›£é€ åˆä½µ", desc: "å°‡è¨­è¨ˆèˆ‡ç›£é€ å·¥ä½œå§”è¨—çµ¦åŒä¸€å®¶å» å•†..." },
        "trialpit": { title: "è©¦æŒ– (Trial Pit)", desc: "åœ¨å·¥ç¨‹è¨­è¨ˆæˆ–é–‹å·¥å‰ï¼Œæ–¼é å®šè·¯å¾‘ä¸ŠæŒ–æ˜å°å‘æ´..." },
        "gis": { title: "GIS (åœ°ç†è³‡è¨Šç³»çµ±)", desc: "Geographic Information System..." },
        "neighbor": { title: "é„°æˆ¿é‘‘å®š", desc: "æ–½å·¥å‰å§”è¨—å…¬æ­£ç¬¬ä¸‰æ–¹ï¼ˆå¦‚å…¬æœƒï¼‰å°æ²¿ç·šå»ºç¯‰ç‰©é€²è¡Œç¾æ³èª¿æŸ¥..." },
        "nvalue": { title: "Nå€¼ (Standard Penetration Test N-Value)", desc: "æ¨™æº–è²«å…¥è©¦é©—å€¼ï¼Œä»£è¡¨åœŸå£¤çš„ã€Œç¡¬åº¦ã€..." },
        "quicksand": { title: "æµç ‚ (Running Sand)", desc: "é£½å«åœ°ä¸‹æ°´çš„é¬†æ•£ç ‚åœŸå±¤..." },
        "backfill": { title: "èƒŒå¡«çŒæ¼¿ (Backfill Grouting)", desc: "æ¨é€²ç®¡ç·šæ–½å·¥æ™‚ï¼Œç®¡å£èˆ‡åœŸå±¤é–“æœƒç”¢ç”Ÿç©ºéš™..." },
        "epb": { title: "åœŸå£“å¹³è¡¡å¼ (EPB)", desc: "Earth Pressure Balance..." },
        "gravel": { title: "åµç¤«çŸ³å±¤ (Gravel)", desc: "å«æœ‰å¤§é‡åœ“å½¢çŸ³å¡Šçš„åœ°å±¤..." },
        "mud": { title: "æ³¥æ¿ƒå¼æ¨é€² (Mud Dense)", desc: "ä½¿ç”¨é«˜æ¿ƒåº¦ã€é«˜é»æ»¯æ€§çš„ç‰¹è£½æ³¥æ¼¿..." },
        "qmax": { title: "è¨ˆç•«æœ€å¤§æ—¥æ±¡æ°´é‡ (Qmax)", desc: "Maximum Hourly Flow..." },
        "lpcd": { title: "å–®ä½æ±¡æ°´é‡ (LPCD)", desc: "Liters Per Capita per Day..." },
        "pf": { title: "å°–å³°ä¿‚æ•¸ (Peaking Factor)", desc: "æœ€å¤§æ™‚æµé‡èˆ‡å¹³å‡æ—¥æµé‡çš„æ¯”å€¼..." },
        "manning": { title: "æ›¼å¯§å…¬å¼ (Manning Formula)", desc: "åœŸæœ¨æ°´åˆ©å·¥ç¨‹è¨ˆç®—æ˜æ¸ æµé€Ÿæœ€å¸¸ç”¨çš„å…¬å¼..." },
        "rcp": { title: "é‹¼ç­‹æ··å‡åœŸç®¡ (RCP)", desc: "Reinforced Concrete Pipe..." },
        "prcp": { title: "èšé…¯æ¨¹è„‚æ··å‡åœŸç®¡ (PRCP)", desc: "Polyester Resin Concrete Pipe..." },
        "clogging": { title: "é¡é¢æ•ˆæ‡‰ (Clogging)", desc: "åœ¨é»åœŸå±¤æ˜é€²æ™‚ï¼Œé»æ€§åœŸç³Šåœ¨åˆ€ç›¤åˆ‡å‰Šé¢ä¸Š..." },
        "slime": { title: "ç”Ÿç‰©è†œæ•ˆæ‡‰ (Slime)", desc: "æ±¡æ°´ç®¡ä½¿ç”¨ä¸€æ®µæ™‚é–“å¾Œï¼Œç®¡å£æ»‹ç”Ÿçš„ä¸€å±¤é»æ»‘ç”Ÿç‰©è†œ..." },
        "tractive": { title: "æƒæµåŠ› (Tractive Force)", desc: "æ°´æµå°ç®¡å£ç”¢ç”Ÿçš„å‰ªæ‡‰åŠ›..." },
        "crowncorr": { title: "å† éƒ¨è…è• (Crown Corrosion)", desc: "æ±¡æ°´ç®¡é ‚éƒ¨å› é€šé¢¨ä¸è‰¯ç”¢ç”Ÿç¡«åŒ–æ°«æ°£é«”..." },
        "flexible": { title: "æŸ”æ€§ç®¡", desc: "å¦‚ PVC æˆ– HDPE ç®¡..." },
        "soilpipe": { title: "ç®¡-åœŸäº’åˆ¶ä½œç”¨", desc: "æŸ”æ€§ç®¡åŸ‹è¨­å¾Œï¼Œç®¡é«”èˆ‡å‘¨åœå›å¡«åœŸå£¤å…±åŒæ‰¿å—è¼‰é‡çš„æ©Ÿåˆ¶..." },
        "gravity": { title: "é‡åŠ›æµç®¡ç·š", desc: "ä¾é ä½èƒ½å·®æµå‹•ï¼Œéœ€ä¿æŒç‰¹å®šå¡åº¦..." },
        "pressure": { title: "å£“åŠ›æµç®¡ç·š", desc: "ä¾é æ³µæµ¦åŠ å£“ï¼Œä¸å—å¡åº¦é™åˆ¶..." },
        "siphon": { title: "å€’è™¹å¸ (Inverted Siphon)", desc: "åˆ©ç”¨é€£é€šç®¡åŸç†ï¼Œè®“æ°´æµå…ˆä¸‹æ½›ç©¿ééšœç¤™ç‰©..." },
        "clearance": { title: "å®‰å…¨æ·¨è·", desc: "å…©ç®¡ç·šé–“éœ€ä¿æŒçš„æœ€å°è·é›¢..." },
        "los": { title: "é“è·¯æœå‹™æ°´æº– (Level of Service, LOS)", desc: "è©•ä¼°äº¤é€šé †æš¢åº¦..." },
        "taper": { title: "æ¼¸è®Šæ®µ (Taper)", desc: "è»Šé“ç¸®æ¸›è™•..." },
        "deck": { title: "è¦†å·¥æ¿ (Deck Plate)", desc: "é«˜å¼·åº¦é‹¼æ¿..." },
        "tilt": { title: "å‚¾åº¦ç›¤ (Tiltmeter)", desc: "å®‰è£æ–¼å»ºç‰©ç‰†é¢..." },
        "ecocheck": { title: "ç”Ÿæ…‹æª¢æ ¸ (Ecological Checklist)", desc: "åœ¨å·¥ç¨‹å„éšæ®µï¼Œé€éè¿´é¿ã€ç¸®å°ã€æ¸›è¼•ã€è£œå„Ÿ..." },
        "lcc": { title: "å…¨ç”Ÿå‘½é€±æœŸæˆæœ¬ (Life Cycle Cost)", desc: "è¨­æ–½å¾è¦åŠƒã€å»ºé€ åˆ°ç¶­è­·ã€æ‹†é™¤çš„ç¸½æˆæœ¬..." },
        "clsm": { title: "CLSM (æ§åˆ¶æ€§ä½å¼·åº¦å›å¡«ææ–™)", desc: "æµå‹•æ€§ä½³ã€å…å¤¯å¯¦çš„å›å¡«ææ–™..." },
        "circular": { title: "å¾ªç’°ç¶“æ¿Ÿ (Circular Economy)", desc: "å°‡è³‡æºåˆ©ç”¨æœ€å¤§åŒ–..." },
        "microtunnel": { title: "å¾®å‹æ¨é€² (Micro-tunneling)", desc: "é©ç”¨æ–¼å°ç®¡å¾‘çš„é™æ§é‘½æ˜æŠ€è¡“..." }
    };

    function openDef(key) {
        const data = glossary[key];
        if(data) {
            document.getElementById('modal-term-title').innerText = data.title;
            document.getElementById('modal-term-desc').innerText = data.desc;
            document.getElementById('glossary-modal').classList.add('active');
        }
    }
    function closeModal(event) { document.getElementById('glossary-modal').classList.remove('active'); }
    function toggleDropdown(menuId) {
        const menu = document.getElementById(menuId);
        const parentBtn = document.getElementById('btn-learn');
        if (menu.style.display === 'flex') { menu.style.display = 'none'; parentBtn.classList.remove('open'); } 
        else { menu.style.display = 'flex'; parentBtn.classList.add('open'); }
    }
    function switchInnerTab(tabId, btn) {
        const parentSection = btn.closest('.view-section');
        parentSection.querySelectorAll('.inner-tab-content').forEach(el => el.classList.remove('active'));
        parentSection.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        btn.classList.add('active');
    }
    function navigate(targetId) {
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.sub-item').forEach(el => el.classList.remove('active'));
        const viewId = 'view-' + targetId;
        const viewEl = document.getElementById(viewId);
        if(viewEl) viewEl.classList.add('active');
        const mainNavItem = document.querySelector(`.nav-item[data-target="${targetId}"]`);
        if (mainNavItem) {
            mainNavItem.classList.add('active');
            if(targetId === 'tools') {
                if(document.getElementById('markdown-container').innerText.includes('è«‹é»æ“Š')) {
                    loadMarkdown('QGIS.md', document.querySelector('#view-tools .tab-btn'));
                }
            }
        } else {
            const subItem = document.querySelector(`.sub-item[data-target="${targetId}"]`);
            if(subItem) {
                subItem.classList.add('active');
                const parentBtn = document.getElementById('btn-learn');
                parentBtn.classList.add('active'); parentBtn.classList.add('open');
                document.getElementById('menu-learn').style.display = 'flex';
            }
        }
        toggleSidebar(false);
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    function toggleSidebar(forceState) {
        const sidebar = document.getElementById('main-sidebar');
        const overlay = document.getElementById('sidebar-overlay');
        if (typeof forceState !== 'undefined') {
            if(forceState) { sidebar.classList.add('mobile-active'); overlay.classList.add('active'); } 
            else { sidebar.classList.remove('mobile-active'); overlay.classList.remove('active'); }
        } else { sidebar.classList.toggle('mobile-active'); overlay.classList.toggle('active'); }
    }
</script>

</body>
</html>
